@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
@{
    
}

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
<style>
    /* 定义不同状态下的背景颜色 */
    .status-connected {
        background-color: rgba(140, 248, 66, 0.8); /* 绿色 */
    }

    .status-disconnected {
        background-color: red; /* 红色 */
    }

    .status-appstart {
        background-color: yellow; /* 黄色 */
    }

    /* 在这里添加更多状态的背景颜色定义 */
</style>
<script>
    const statusDisplayMap = {
        'Connected': '挖礦中，不要吵我',
        'Disconnected': '幹，斷線了',
        'AppStart': '應用程式啟動中',
        'LoginPage': '登入中',
        'LoginError': '你他媽帳號密碼打錯了',
        'Error': '程式掛了，請回報錯誤訊息',
        'Stop': '程式停止中'
    };

    setInterval(function () {
        $(document).ready(function () {
            $.ajax({
                url: 'Miner/GetMinerRecord', 
                type: 'GET',
                dataType: 'json',
                xhrFields: {
                    withCredentials: true 
                },
                success: function (data) {
                    const statusDisplay = statusDisplayMap[data.Status] || data.Status;
                    $('#loginUserName').text(data.LoginUserName);
                    $('#status').text(statusDisplay);
                    $('#isConnected').text(data.IsConnected);
                    $('#reconnectSeconds').text(data.ReconnectSeconds);
                    $('#reconnectCounts').text(data.ReconnectCounts);
                    $('#exception').text(data.Exception);
                    $('#exceptionTime').text(data.ExceptionTime);

                    $('#card').removeClass().addClass('card');
                    switch (data.Status) {
                        case 'Connected':
                            $('#card').addClass('status-connected');
                            break;
                        case 'Disconnected':
                        case 'Error':
                        case 'Stop':
                            $('#card').addClass('status-disconnected');
                            break;
                        default:
                            $('#card').addClass('status-appstart');
                            break;
                    }

                    if (data.Exception && data.status == "Error") {
                        $('#exMsg').show();
                        $('#exTime').show();
                    } else {
                        $('#exMsg').hide();
                        $('#exTime').hide();
                    }

                    if (data.Status == "Disconnected") {
                        $('#recSec').show();
                        $('#recCount').show();
                    } else {
                        $('#recSec').hide();
                        $('#recCount').hide();
                    }
                    if (data.Status == "Stop") {
                           $('#binStart').show();
                           $('#bthStop').hide();
                    }
                    else {
                        $('#binStart').hide();
                        $('#bthStop').show();
                    }
                },
                error: function (xhr, status, error) {
                    console.error(xhr.responseText);
                }
            });
        });
    }, 500);
</script>

<div class="text-center">
    <div class="row">
        <div class="col-md-4 mb-4">
            <div class="card" id="card">
                <div class="card-body">
                    <h5 class="card-title" style="color:blue;" id="使用者名稱"></h5>
                    <p class="card-text">
                        <strong style="color:blue;">狀態: </strong> <span id="status"></span><br /><br />
                        <strong style="color:blue;">是否連線: </strong> <span id="isConnected"></span><br /><br />
                        <div id="recSec">
                            <strong style="color:blue;">重連秒數: </strong> <span id="reconnectSeconds"></span><br /><br />
                        </div>

                        <div id="recCount">
                            <strong style="color:blue;">重連次數: </strong> <span id="reconnectCounts"></span><br /><br />
                        </div>
                        <div id="exMsg"><strong style="color:blue;">錯誤訊息: </strong> <span id="exception"></span><br /><br /></div>
                        <div id="exTime"><strong style="color:blue;">錯誤時間: </strong> <span id="exceptionTime"></span><br /><br /></div>

                        <div id="binStart">
                            @Html.ActionLink("開始", "Start")
                        </div>

                        <div id="bthStop">
                            @Html.ActionLink("停止", "Stop")

                        </div>


                    </p>
                </div>
            </div>
        </div>
    </div>
</div>